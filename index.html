<!-- ... tudo igual até o script -->
<script>
  const form = document.getElementById('formulario');
  const mensagem = document.getElementById('mensagem');
  const scriptURL = "https://script.google.com/macros/s/SEU_SCRIPT_ID/exec";

  form.addEventListener('submit', e => {
    e.preventDefault();
    const formData = new FormData(form);

    fetch(scriptURL, { method: 'POST', body: formData })
      .then(response => response.text())
      .then(data => {
        mensagem.textContent = data;
        form.reset();
        carregarHorarios(); // Atualiza os horários após envio
      })
      .catch(error => {
        mensagem.textContent = "Erro ao enviar agendamento.";
        console.error('Erro:', error);
      });
  });

  async function carregarHorarios() {
    const select = document.getElementById('hora');
    const dataSelecionada = document.getElementById('data').value;
    select.innerHTML = '<option value="">Carregando horários...</option>';

    const horariosPossiveis = [];
    let h = 7, m = 10;
    while (h < 11 || (h === 10 && m <= 50)) {
      horariosPossiveis.push(`${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`);
      m += 10;
      if (m >= 60) { m = 0; h++; }
    }

    try {
      const res = await fetch(`${scriptURL}?data=${encodeURIComponent(dataSelecionada)}`);
      const agendados = await res.json();

      select.innerHTML = '<option value="">Selecione o horário</option>';
      horariosPossiveis.forEach(horario => {
        if (!agendados.includes(horario)) {
          const option = document.createElement('option');
          option.value = horario;
          option.textContent = horario;
          select.appendChild(option);
        }
      });
    } catch (err) {
      select.innerHTML = '<option>Erro ao carregar horários</option>';
    }
  }

  window.onload = carregarHorarios;
</script>
